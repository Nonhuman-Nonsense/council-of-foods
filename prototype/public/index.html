<!DOCTYPE html>
<html>

<head>
  <title>Council Prototype</title>
  <link rel="stylesheet" href="style.css?v=1.0">
  <link href="favicon.png" rel="shortcut icon" type="image/png" />
  <script src="/socket.io/socket.io.js"></script>
  <script src="vue.global.js"></script>
  <style>
    [v-cloak] {
      display: none;
    }
  </style>
</head>

<body>
  <div id="app" v-cloak>
    <main>
      <div id="setup">
        <div id="global-vars">
          <h3>model options</h3>
          GPT Model: <div class="explanaition">Available models on: https://platform.openai.com/docs/models</div>
          <input type="text" v-model="options.gptModel" class="explain" /><br />

          Temperature: <div class="explanaition">Controls randomness...</div>
          <input type="range" min="0" max="2.0" step="0.01" v-model.number="options.temperature" class="slider explain">
          <input class="slider-value" step="0.01" type="number" v-model.number="options.temperature"><br />

          Maximum Length: <div class="explanaition">Max tokens...</div>
          <input type="range" min="1" max="600" v-model.number="options.maxTokens" class="slider explain">
          <input class="slider-value" type="number" step="10" v-model.number="options.maxTokens"><br />

          Chair Maximum Length: <div class="explanaition">Same as above, but for chair Water.</div>
          <input type="range" min="1" max="600" v-model.number="options.chairMaxTokens" class="slider explain">
          <input class="slider-value" type="number" step="10" v-model.number="options.chairMaxTokens"><br />

          Frequency Penalty: <div class="explanaition">Penalize new tokens...</div>
          <input type="range" min="0" max="2.0" step="0.01" v-model.number="options.frequencyPenalty"
            class="slider explain">
          <input class="slider-value" step="0.01" type="number" v-model.number="options.frequencyPenalty"><br />

          Presence Penalty: <div class="explanaition">Penalize repeated tokens...</div>
          <input type="range" min="0" max="2.0" step="0.01" v-model.number="options.presencePenalty"
            class="slider explain">
          <input class="slider-value" type="number" step="0.01" v-model.number="options.presencePenalty"><br />

          Audio Speed: <div class="explanaition">The speed of the audio.</div>
          <input type="range" min="0" max="2.0" step="0.01" v-model.number="options.audio_speed" class="slider explain">
          <input class="slider-value" type="number" step="0.01" v-model.number="options.audio_speed"><br />

          <br />
          <h3>server options</h3>
          trim response to last complete sentance: <input type="checkbox" v-model="options.trimSentance"><br>
          trim response to last complete paragraph: <input type="checkbox" v-model="options.trimParagraph"><br>
          trim response to remove chairs semicolon ending: <input type="checkbox"
            v-model="options.trimChairSemicolon"><br>
          conversation max length: <input type="number" v-model.number="options.conversationMaxLength"><br />
          extra message count: <input type="number" v-model.number="options.extraMessageCount"><br />

          Reset everything to default: <button @click="factoryReset">Factory Reset</button><br />
          <br />
          <h3>prototype options</h3>
          skip creating audio: <input type="checkbox" v-model="options.skipAudio"><br>
        </div>
        <br>
        <div id="language-el">
          <h3>language</h3>
          <template v-for="lang in available_languages" :key="lang">
            <input type="radio" :id="'language-'+lang" :value="lang" v-model="options.language">
            <label :for="'language-'+lang">{{lang}}</label>
          </template>
        </div>
        <div id="system-el">
          <h3>system prompt</h3>
          <textarea v-model="currentSystemPrompt" placeholder="system prompt..."></textarea><br>
          <p style="margin: 0;"><small>the word [TOPIC] will be replaced with the room topic from below</small></p>
        </div>
        <br>
        <div id="room-el">
          <h3>rooms</h3>
          <div id="rooms">
            <span id="room-buttons">
              <button v-for="(room, index) in currentLanguageData.rooms" :key="index" @click="currentRoomIndex = index"
                :class="{ active: currentRoomIndex === index }">
                {{ room.name }}
              </button>
            </span>
            <button @click="addRoom">+</button>
            <button @click="removeRoom">-</button>
          </div>
        </div>
        <br>
        <div id="panel-prompt-el" v-if="currentRoom">
          <h3>room name</h3>
          <p><input v-model="currentRoom.name" type="text" placeholder="Room name"></p>
          <h3>topic</h3>
          <p><textarea v-model="currentRoom.topic" placeholder="panel prompt"></textarea></p>
        </div>
        <br>
        <div id="characters-container" v-if="currentRoom">
          <h3>characters</h3>
          <br>
          <p style="margin: 0;"><small>if the word [FOODS] is present in the first character, it will be replaced with
              names of the other characters.</small></p>
          <p style="margin: 0;"><small>the word [HUMANS] is ignored for now, human panelist are not supported in
              prototype</small></p>

          <div id="characters">
            <div class="character" v-for="(character, index) in currentRoom.characters"
              :key="character._ui_id || index">

              <span class="drag-handle" style="color: #ccc; font-weight: bold; margin-right: 5px; cursor: move;">⋮⋮
              </span>

              <input type="text" placeholder="character name" v-model="character.name">
              <textarea class="prompt" placeholder="character prompt" v-model="character.prompt"></textarea>

              <div class="voices">
                <span>voice: </span>
                <template v-for="(voiceName, vIndex) in audioVoices">
                  <input type="radio" :id="'voice-'+index+'-'+voiceName" :value="voiceName" v-model="character.voice">
                  <label :for="'voice-'+index+'-'+voiceName">{{voiceName}}</label>
                </template>
              </div>

              <textarea class="voiceInstruction" placeholder="voice instruction"
                v-model="character.voiceInstruction"></textarea>
            </div>
          </div>
          <button @click="addCharacter">+</button>
          <button @click="removeCharacter">-</button>
        </div>

        <div id="injections">
          <h3>inject custom instruction</h3><br />
          <p style="margin: 0;"><small>the word [DATE] will be replaced with todays date</small></p>
          <textarea v-model="options.injectPrompt" placeholder="Inject something into water..."></textarea><br>

          Maximum Length: <div class="explanaition">Max tokens for injection...</div>
          <input type="range" min="1" max="2000" v-model.number="options.maxTokensInject" class="slider explain">
          <input class="slider-value" type="number" step="10" v-model.number="options.maxTokensInject"><br />

          <button @click="removeLastMessage">remove last message</button>
          <button @click="submitInjection" v-if="!injectionStatus">{{ 'send' }}</button>
          <span v-else>{{ injectionStatus }}</span>
        </div>

        <br>
        <button v-if="!conversationActive && !endMessage" @click="toggleConversation">{{ conversationStarted ? 'Resume'
          : 'Start' }}</button>
        <button v-if="conversationActive" @click="toggleConversation">Pause</button>
        <button v-if="conversationStarted && !conversationActive" @click="restartConversation">Restart</button>
        <button v-if="endMessage" @click="continueConversation">Keep Going</button>
      </div>

      <div id="conversation-container">
        <div id="conversation">
          <div v-for="turn in conversation" :key="turn.id" :id="turn.id"
            v-show="options.showTrimmed || turn.type !== 'skipped'">
            <p>
              <strong>{{turn.speaker}}:</strong>
              <span v-if="options.showTrimmed && turn.pretrimmed" class="trimmed"
                v-html="turn.pretrimmed.split('\n').join('<br>')"></span>
              <span v-html="turn.text.split('\n').join('<br>')"></span>
              <span v-if="options.showTrimmed && turn.trimmed" class="trimmed"
                v-html="turn.trimmed.split('\n').join('<br>')"></span>
            </p>
          </div>
        </div>
        <div id="end-message" v-if="endMessage">{{ endMessage }}</div>
        <div id="spinner" class="loader" v-if="loading"></div>

        <div id="audio-controls">
          <button @click="audioBack">&#x23EE;</button>
          <button @click="audioToggle" :style="{ background: audioPaused ? 'red' : null }">&#x23EF;</button>
          <button @click="audioNext">&#x23ED;</button>
        </div>
        <div id="display-settings">
          <input type="checkbox" v-model="options.showTrimmed"> showed trimmed content
        </div>
      </div>
    </main>
  </div>

  <script src="Sortable.min.js"></script>
  <script src="prototype_client.js?v=2.0"></script>
</body>

</html>